"use strict";
/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunkgame_server"] = self["webpackChunkgame_server"] || []).push([["src_levels_there-be-mages_mjs"],{

/***/ "./src/collisions.mjs":
/*!****************************!*\
  !*** ./src/collisions.mjs ***!
  \****************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"rectanglesOverlap\": () => (/* binding */ rectanglesOverlap)\n/* harmony export */ });\nconst rectanglesOverlap = (rect, rect2) => {\n  return (\n    rect.x + rect.width >= rect2.x &&\n    rect.x < rect2.x + rect2.width &&\n    rect.y + rect.height >= rect2.y &&\n    rect.y < rect2.y + rect2.height\n  )\n}\n\n\n//# sourceURL=webpack://game-server/./src/collisions.mjs?");

/***/ }),

/***/ "./src/levels/there-be-mages.mjs":
/*!***************************************!*\
  !*** ./src/levels/there-be-mages.mjs ***!
  \***************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _controller_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../controller.mjs */ \"./src/controller.mjs\");\n/* harmony import */ var _textures_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../textures.mjs */ \"./src/textures.mjs\");\n/* harmony import */ var _entities_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../entities.mjs */ \"./src/entities.mjs\");\n/* harmony import */ var _player_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../player.mjs */ \"./src/player.mjs\");\n/* harmony import */ var _texture_data_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../texture-data.mjs */ \"./src/texture-data.mjs\");\n/* harmony import */ var _collision_map_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../collision-map.mjs */ \"./src/collision-map.mjs\");\n/* harmony import */ var _mage_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../mage.mjs */ \"./src/mage.mjs\");\n/* harmony import */ var _collisions_mjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../collisions.mjs */ \"./src/collisions.mjs\");\n\n\n\n\n\n\n\n\n\nconst $ = (id) => document.getElementById(id)\n\nconst canvas = $('game')\nconst ctx = canvas.getContext('2d')\nctx.fillStyle = 'rgb(33, 35, 47)'\n\nctx.mozImageSmoothingEnabled = false;\nctx.webkitImageSmoothingEnabled = false;\nctx.msImageSmoothingEnabled = false;\nctx.imageSmoothingEnabled = false;\n\nconst texturesData = [\n  ..._texture_data_mjs__WEBPACK_IMPORTED_MODULE_4__.playerTextures,\n  // {\n  //   src: 'ruins.png',\n  //   name: 'ground',\n  // },\n  {\n    src: 'ruins-II-bg.png',\n    name: 'background',\n  },\n  {\n    src: 'ruins-II.png',\n    name: 'foreground',\n  },\n  {\n    src: 'collision-map-ruins-II.png',\n    name: 'collision-map',\n  },\n  {\n    src: 'snow-platform.png',\n    name: 'snow-platform',\n  },\n  {\n    src: 'mage3.png',\n    name: 'mage',\n  },\n  {\n    src: 'mage3-left.png',\n    name: 'mage-left',\n  },\n]\n\nlet lastTime = (new Date()).getTime()\nlet currentTime = 0\nlet dt = 0\n\nconst player = (0,_player_mjs__WEBPACK_IMPORTED_MODULE_3__.createPlayer)(64, canvas.height - 164)\n;(0,_entities_mjs__WEBPACK_IMPORTED_MODULE_2__.addEntity)(player)\n\ndocument.addEventListener('keydown', (e) => {\n  ;(0,_controller_mjs__WEBPACK_IMPORTED_MODULE_0__.handleKeyDown)(e)\n}, false)\n\ndocument.addEventListener('keyup', e => {\n  ;(0,_controller_mjs__WEBPACK_IMPORTED_MODULE_0__.handleKeyUp)(e)\n}, false)\n\n;(0,_controller_mjs__WEBPACK_IMPORTED_MODULE_0__.registerActions)([\n  {\n    name: 'jump',\n    keycode: '32',\n  },\n  // {\n  //   name: 'left',\n  //   keycode: '65',\n  // },\n  // {\n  //   name: 'right',\n  //   keycode: '68',\n  // },\n  // {\n  //   name: 'down',\n  //   keycode: '83',\n  // },\n  {\n    name: 'left',\n    keycode: '74',\n  },\n  {\n    name: 'right',\n    keycode: '76',\n  },\n  {\n    name: 'down',\n    keycode: '75',\n  },\n  {\n    name: 'restart',\n    keycode: '82',\n  },\n])\n\n;(0,_controller_mjs__WEBPACK_IMPORTED_MODULE_0__.addActionDownListener)('jump', () => {\n  player.jump()\n})\n\n;(0,_controller_mjs__WEBPACK_IMPORTED_MODULE_0__.addActionDownListener)(('restart'), () => {\n  player.respawn()\n})\n\nconst init = async () => {\n  await (0,_textures_mjs__WEBPACK_IMPORTED_MODULE_1__.loadTextures)(texturesData)\n\n  ;(0,_collision_map_mjs__WEBPACK_IMPORTED_MODULE_5__.setCollisionMap)((0,_textures_mjs__WEBPACK_IMPORTED_MODULE_1__.getTextureByName)('collision-map'))\n\n  // Just know that any lag will make the player fall through the floor.\n  lastTime = (new Date()).getTime()\n  currentTime = 0\n  dt = 0\n\n  window.requestAnimationFrame(update)\n}\n\nconst update = () => {\n  window.requestAnimationFrame(update)\n\n  currentTime = (new Date()).getTime()\n  dt = (currentTime - lastTime) / 1000\n\n  ;(0,_entities_mjs__WEBPACK_IMPORTED_MODULE_2__.updateEntities)(dt)\n\n  // if (player.x + 32 < 0) {\n  //   window.location.href = '/night'\n  // } else if (player.x + 32 > canvas.width) {\n  //   window.location.href = '/shadows'\n  // }\n\n  const entities = (0,_entities_mjs__WEBPACK_IMPORTED_MODULE_2__.getEntities)()\n  entities.forEach(entity => {\n    if (player !== entity && (0,_collisions_mjs__WEBPACK_IMPORTED_MODULE_7__.rectanglesOverlap)(player.getCollider(), entity.getCollider())) {\n      if (player.y + player.getCollider().height < entity.y + 28) {\n        player.bounce()\n        entity.turn()\n      } else {\n        player.respawn()\n      }\n    }\n  })\n\n  render()\n\n  lastTime = currentTime\n}\n\nwindow.onpageshow = () => {\n  player.x = player.startX\n  player.y = player.startY\n  player.setSprite('idle')\n  player.xSpeed = 0\n  player.ySpeed = 0\n  player.grounded = true\n  currentTime = (new Date()).getTime()\n  dt = (currentTime - lastTime) / 1000\n  lastTime = currentTime\n  ;(0,_controller_mjs__WEBPACK_IMPORTED_MODULE_0__.clearKeys)()\n}\n\nconst randomRange = (min, max) =>\n  Math.floor(Math.random() * (max - min + 1) + min)\n\nconst spawnMage = () => {\n  const mage = (0,_mage_mjs__WEBPACK_IMPORTED_MODULE_6__.createMage)(canvas.width - 64 - 26 * 2, canvas.height - 64 - 28 * 2)\n  ;(0,_entities_mjs__WEBPACK_IMPORTED_MODULE_2__.addEntity)(mage)\n  setTimeout(spawnMage, randomRange(1, 10) * 1000)\n}\n\nspawnMage()\n\nconst render = () => {\n  // const ground = getTextureByName('ground')\n  const background = (0,_textures_mjs__WEBPACK_IMPORTED_MODULE_1__.getTextureByName)('background')\n  const foreground = (0,_textures_mjs__WEBPACK_IMPORTED_MODULE_1__.getTextureByName)('foreground')\n  const snowPlatform = (0,_textures_mjs__WEBPACK_IMPORTED_MODULE_1__.getTextureByName)('snow-platform')\n  const mage = (0,_textures_mjs__WEBPACK_IMPORTED_MODULE_1__.getTextureByName)('mage')\n  // const snowman = getTextureByName('snowman')\n\n  ctx.clearRect(0, 0, canvas.width, canvas.height)\n  ctx.fillRect(0, 0, canvas.width, canvas.height)\n\n  ctx.drawImage(\n    background,\n    0,\n    0,\n    canvas.width,\n    canvas.height,\n  )\n\n  ctx.drawImage(\n    foreground,\n    0,\n    0,\n    canvas.width,\n    canvas.height,\n  )\n\n  ctx.drawImage(\n    snowPlatform,\n    canvas.width * 0.5 - snowPlatform.width,\n    canvas.height * 0.5 - snowPlatform.height,\n    snowPlatform.width * 2,\n    snowPlatform.height * 2,\n  )\n\n  ;(0,_entities_mjs__WEBPACK_IMPORTED_MODULE_2__.renderEntities)(ctx, canvas)\n  // debugRenderEntities(ctx, canvas)\n}\n\ninit().then(() => {\n\n}).catch(() => {\n\n})\n\n\n//# sourceURL=webpack://game-server/./src/levels/there-be-mages.mjs?");

/***/ }),

/***/ "./src/mage.mjs":
/*!**********************!*\
  !*** ./src/mage.mjs ***!
  \**********************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"createMage\": () => (/* binding */ createMage)\n/* harmony export */ });\n/* harmony import */ var _config_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./config.mjs */ \"./src/config.mjs\");\n/* harmony import */ var _textures_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./textures.mjs */ \"./src/textures.mjs\");\n\n\n\nconst MAGE_WIDTH = 26\nconst MAGE_HEIGHT = 28\n\nconst MOVE_SPEED = 150\n\nconst createMage = (x, y) => {\n  const mage = {\n    x,\n    y,\n    facing: _config_mjs__WEBPACK_IMPORTED_MODULE_0__.DIRECTION.LEFT,\n    sprite: 'mage',\n    xSpeed: -MOVE_SPEED,\n    collider: {\n      x: 0,\n      y: 0,\n      width: MAGE_WIDTH * 2,\n      height: MAGE_HEIGHT * 2,\n    }\n  }\n\n  mage.getCollider = () => ({\n    x: mage.x + mage.collider.x,\n    y: mage.y + mage.collider.y,\n    width: mage.collider.width,\n    height: mage.collider.height,\n  })\n\n  mage.turn = () => {\n    mage.facing *= -1\n    mage.xSpeed *= -1\n  }\n\n  mage.update = (dt) => {\n    mage.x += mage.xSpeed * dt\n    if (mage.x < 64) {\n      mage.x = 64\n      mage.xSpeed = MOVE_SPEED\n      mage.facing = _config_mjs__WEBPACK_IMPORTED_MODULE_0__.DIRECTION.RIGHT\n    }\n\n    if (mage.x > 640 - (MAGE_WIDTH * 2 + 64)) {\n      mage.x = 640 - (MAGE_WIDTH * 2 + 64)\n      mage.xSpeed = -MOVE_SPEED\n      mage.facing = _config_mjs__WEBPACK_IMPORTED_MODULE_0__.DIRECTION.LEFT\n    }\n  }\n\n  mage.render = (ctx, canvas) => {\n    const sprite = (0,_textures_mjs__WEBPACK_IMPORTED_MODULE_1__.getTextureByName)(\n      mage.facing === _config_mjs__WEBPACK_IMPORTED_MODULE_0__.DIRECTION.RIGHT ?\n        mage.sprite :\n        `${mage.sprite}-left`\n    )\n    ctx.drawImage(\n      sprite,\n      mage.x,\n      mage.y,\n      MAGE_WIDTH * 2,\n      MAGE_HEIGHT * 2,\n    )\n  }\n\n  mage.debugRender = (ctx, canvas) => {\n    ctx.beginPath()\n    const mageCollider = mage.getCollider()\n    ctx.rect(mageCollider.x, mageCollider.y, mageCollider.width, mageCollider.height)\n    ctx.stroke()\n  }\n\n  return mage\n}\n\n\n//# sourceURL=webpack://game-server/./src/mage.mjs?");

/***/ })

}]);